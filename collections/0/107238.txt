During the Mexican–American War, American forces marched toward Mexico City itself after capturing Veracruz. President Santa Anna first tried blocking their way at Cerro Gordo in the Veracruz highlands.[98] The first battle to defend Mexico City itself was the Battle of Contreras. A fortified hacienda in the town of San Antonio covered the southeastern approach, while the town of San Ángel covered the southwestern. Between them lay a vast, seemingly impenetrable lava field, called El Pedrégal. General Gabriel Valencia decided to move his troops from San Ángel to the then town of Contreras. Despite being forewarned of U.S. intentions by a tactical mistake, the Mexicans found themselves outgunned by the invading army at Contreras. This allowed the Americans to cross the Pedrégal and move in on the Mexican troops at San Antonio from behind.[99] The assault on the carefully laid defenses at San Antonio became known as the Battle of Churubusco. Knowing of the Americans' approach, Santa Anna ordered General Pedro María de Anaya to move his troops to a monastery in Churubusco. While Anaya's position was eventually overrun, he held off the Americans for some time. However, the Mexican army lost 10,000 defenders.[100] The Battle of Molino del Rey was the last just before the Americans entered the old city itself. The war ended with the attack of Chapultepec Castle, headquarters of the military college, where young students defended the castle. In this place died in the battle the Niños Héroes, students of the college with ages from 13 to 19 years. General Gideon Pillow and his 2,500 men led the assault, starting from the Molino del Rey to the west of Chapultepec. General John Quitman entered in from the south to cut Chapultepec off from reinforcements, while General David Twiggs fought against positions further east. Inside the walls, General Nicolás Bravo realized that his 1,000 men were too few to hold the castle, but he attempted to do so. Mexican troops on the western slope of the castle held for a while, but Pillow's men captured the castle by 9:30 am the day of the attack.[4] To end the war officially, American and Mexican representatives met at the Villa of Guadalupe Hidalgo, across from the shrine of the patron saint of Mexico, in what is now the far north of the city. They signed the Treaty of Guadalupe Hidalgo, and then celebrated a mass together at the basilica.[101]